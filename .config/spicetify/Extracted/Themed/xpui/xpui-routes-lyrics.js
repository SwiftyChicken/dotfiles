"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[25],{43325:function(e,t,r){r.r(t),r.d(t,{LyricsContainer:function(){return F},default:function(){return $}});var n=r(27378),a=r.n(n),c=r(23104),i=r(66917),l=r.n(i),s=r(85466),o=r(86930),u=r(33877);const d={status:u.c.LOADING},v={status:u.c.UNAVAILABLE},m=(e,t)=>{const[r,n]=(0,s.Z)();if(!e||!l().isTrack(e)||!t)return v;const a=r[e];return a||(n({type:"LYRICS_LOADING",uri:e}),(0,o.SW)(e,t).then((t=>{n({type:"LYRICS_LOADED",uri:e,response:t})})).catch((t=>{404===t.status?n({type:"LYRICS_UNAVAILABLE",uri:e}):n({type:"LYRICS_ERROR",uri:e})})),d)};var y=r(14298),f=r(45502),g="tWCG1__GYvwq6QmxJQsc",p="vSfoFiI4WuABjWl7cyd4",b="liLgW_Anyf1OrRpO1IID",E="_gtj_n_uxRq4P7iSQ_3c",k="VprGkpql5qCwYTRGvUnp",O="xUEC7JecXHxcmHdLLkY4",L="wR02E0JALxR4vJozjfJl",h="AIfgPe2VfPu6X3gcS5Iz",N="kbMExU5zc2on87qZEu5g",x="hr8GfMsh60PbgVDwa8lz",A="DGkVyx6TZiAUb8UsE5kv",D=r(65526),S=r.n(D),I=r(35181),R=r(26102),j=r(38655);function w(e,t){const[r,a]=(0,n.useState)(!1),[c,i]=(0,n.useState)(0),l=(0,n.useMemo)((()=>(0,R.N)({lyrics_format:t,track_uri:e})),[t,e]);return(0,n.useEffect)((()=>{a(!1),i(0)}),[l]),(0,n.useEffect)((()=>{if(!r&&c>140){(0,j.M)().send(l),a(!0)}}),[c,r,l]),i}var U=r(9807),_=r(80702);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){S()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const G={start:0,end:1,text:""},M={"--line-count":3},T=a().memo((({lyrics:e=[],provider:t,trackUri:r})=>{const[c]=(0,_.z)(500,(e=>{var t;return(null==e||null===(t=e.item)||void 0===t?void 0:t.uri)===r})),i=w(r,"card"),l=(0,n.useMemo)((()=>[G,G,...e].map(((e,t)=>P(P({},e),{},{lineNumber:t})))),[e]),s=l.findIndex((({start:e,end:t})=>c>=e&&c<t)),o=(0,n.useMemo)((()=>{const e=Math.max(s-1,0);return l.slice(e,e+3+2)}),[s,l]);return(0,n.useEffect)((()=>{i((e=>l.reduce(((e,{text:t,lineNumber:r})=>{const n=t.length>1?t.length:0;return e+=s===r?n:0}),e)))}),[l,s,i]),a().createElement("div",{className:O,style:M},a().createElement("div",{className:N},o.map((({text:e,lineNumber:t},r)=>{const n={"--animation-index":r};return a().createElement("p",{className:x,style:n,key:t,dir:"auto"},e)}))),t&&a().createElement(U.Dy,{as:"p",variant:U.Dy.mesto,className:h,dir:"auto"},I.ag.get("lyrics.providedBy",t)))}));var Y=r(9957);const V=a().memo((({onObserve:e,text:t})=>{const{ref:r,inView:c}=(0,Y.YD)({threshold:0});return(0,n.useEffect)((()=>{c&&e(t)}),[c,e,t]),a().createElement("p",{className:x,ref:r,dir:"auto","data-testid":"unsynced-lyric"},t)})),J=a().memo((({lyrics:e=[],provider:t,trackUri:r})=>{const c=w(r,"fullscreen"),i=(0,n.useCallback)((e=>{e.length>1&&c((t=>t+e.length))}),[c]);return a().createElement("div",{className:E},a().createElement(U.Dy.p,{variant:U.$e.ballad,className:k},I.ag.get("lyrics.unsynced")),a().createElement("div",null,e.map((({text:e},t)=>a().createElement(V,{key:r+t,onObserve:i,text:e})))),t&&a().createElement(U.Dy,{as:"p",variant:U.Dy.mesto,className:h,dir:"auto"},I.ag.get("lyrics.providedBy",t)))}));var B=r(35638);const q=[I.ag.get("lyrics.noLyrics0"),I.ag.get("lyrics.noLyrics1"),I.ag.get("lyrics.noLyrics2"),I.ag.get("lyrics.noLyrics3")],z=a().memo((({version:e})=>{let t;switch(e){case"ad":t=I.ag.get("lyrics.ad");break;case"error":t=I.ag.get("lyrics.error");break;case"unavailable":t=q[Math.floor(Math.random()*q.length)];break;default:(0,B.U)(e)}return a().createElement("div",{className:b},a().createElement("span",{className:A},t))}));var W=r(82907),Z=r(67684),H=r(86268);const Q=a().createElement("div",{className:p},a().createElement(f.H,null)),X={active:y.ixZ,inactive:y.Snx,background:y.tGJ},F=()=>{var e,t,r,n,i,s,o,u,d;const v=(0,c.v9)(W.Ci),f=(null==v?void 0:v.uri)||"",p=(null==v||null===(e=v.album)||void 0===e||null===(t=e.images)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.url)||"",{status:b,data:E}=m(f,p);let k={active:null!==(n=null==E?void 0:E.colors.active)&&void 0!==n?n:X.active,inactive:null!==(i=null==E?void 0:E.colors.bright)&&void 0!==i?i:X.inactive,background:null!==(s=null==E?void 0:E.colors.dark)&&void 0!==s?s:X.background};!1===(null==E?void 0:E.isTimeSynced)&&(k=X),(0,H.Y)(k.background,X.background);const[O]=(0,c.v9)(W.e5);m((null==O?void 0:O.uri)||"",(null==O||null===(o=O.album)||void 0===o||null===(u=o.images)||void 0===u||null===(d=u[0])||void 0===d?void 0:d.url)||"");let h=Q;if(f)if(l().isAd(f))h=a().createElement(z,{version:"ad"});else if(b===Z.LyricsTrackStatus.UNAVAILABLE)h=a().createElement(z,{version:"unavailable"});else if(b===Z.LyricsTrackStatus.ERROR)h=a().createElement(z,{version:"error"});else if(b===Z.LyricsTrackStatus.LOADED&&E){const{lyrics:e,provider:t,isTimeSynced:r}=E;h=r?a().createElement(T,{trackUri:f,lyrics:e,provider:t}):a().createElement(J,{trackUri:f,lyrics:e,provider:t})}const N={"--lyrics-color-active":k.active,"--lyrics-color-inactive":k.inactive,"--lyrics-color-background":k.background,"--lyrics-color-messaging":null!=E&&E.isTimeSynced?y.tGJ:y.ixZ};return a().createElement("div",{className:g,style:N},a().createElement("div",{className:L}),h)};var $=F}}]);
//# sourceMappingURL=xpui-routes-lyrics.js.map